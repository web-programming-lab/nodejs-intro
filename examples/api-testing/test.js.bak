const request = require('supertest');
const app = require('./app.js');

describe('GET /technologies', () => {
    it('responds with 200', (done) => {
        request(app)
            .get('/technologies')
            .expect(200, done);
    });

    it('responds with one technology', async () => {
        const insertOne = jest.fn().mockResolvedValueOnce({ acknowleged: true })
        const collection = jest.fn().mockReturnValueOnce({ insertOne })
        const connectSpy = jest.spyOn(MongoClient, 'connect').mockResolvedValueOnce({ db: jest.fn().mockReturnValueOnce({ collection }), close: jest.fn() })


        const response = await request(app)
                                .get('/technologies');

        expect(response.body).toBeDefined();
        const technology = response.body[0];
        expect(technology).toBeDefined();
        expect(technology.name).toBe('ArgoCD');
    });
});